# 세션 관리 정보

## 현재 구현된 세션 관리

### 세션 저장 방식
- **저장 위치**: localStorage (브라우저 로컬 스토리지)
- **저장 키**: `auth-storage`
- **저장 내용**: 사용자 정보(user)와 세션(session)

### 세션 만료 시간
- **기본 만료 시간**: 30일
- 로그인 시 자동으로 30일 후 만료되도록 설정됨
- 만료 시간은 `src/store/authStore.js`에서 수정 가능

### 세션 유지 메커니즘

1. **로그인 시**:
   - 사용자 정보를 zustand store에 저장
   - localStorage에 자동으로 persist됨
   - 만료 시간 30일로 설정

2. **페이지 새로고침 시**:
   - localStorage에서 세션 정보 자동 로드
   - 세션 만료 여부 확인
   - 만료되지 않았다면 Supabase에서 최신 사용자 정보 조회
   - 사용자가 비활성화되었으면 자동 로그아웃

3. **세션 검증**:
   - 매 페이지 새로고침마다 사용자 정보 갱신
   - 비활성화된 계정은 자동으로 로그아웃

## 설정 방법

### 1. Supabase 마이그레이션 실행

`supabase/migrations/20250116_get_user_by_id_function.sql` 파일을 Supabase SQL Editor에서 실행하세요.

### 2. 세션 만료 시간 변경 (선택사항)

`src/store/authStore.js` 파일에서 만료 시간을 변경할 수 있습니다:

```javascript
expires_at: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30일

// 다른 예시:
// 7일: (7 * 24 * 60 * 60 * 1000)
// 1일: (1 * 24 * 60 * 60 * 1000)
// 12시간: (12 * 60 * 60 * 1000)
```

## 동작 흐름

```
┌─────────────────┐
│   사용자 로그인   │
└────────┬────────┘
         │
         ▼
┌─────────────────────────┐
│ localStorage에 저장     │
│ - user 정보             │
│ - session (30일 만료)   │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│   페이지 새로고침        │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│ localStorage에서 로드    │
└────────┬────────────────┘
         │
         ▼
    ┌────────┐
    │ 만료?   │
    └───┬─┬──┘
        │ │
     Yes│ │No
        │ │
        │ └──────────────────┐
        │                    │
        ▼                    ▼
┌──────────────┐    ┌────────────────────┐
│ 자동 로그아웃 │    │ 사용자 정보 갱신   │
└──────────────┘    └────────┬───────────┘
                             │
                             ▼
                        ┌─────────┐
                        │ 활성?    │
                        └────┬─┬──┘
                             │ │
                          No │ │Yes
                             │ │
                             │ └──────────────┐
                             ▼                │
                        ┌──────────────┐      │
                        │ 자동 로그아웃 │      │
                        └──────────────┘      │
                                             ▼
                                     ┌──────────────┐
                                     │ 세션 유지    │
                                     └──────────────┘
```

## 보안 고려사항

1. **localStorage 사용**:
   - XSS 공격에 취약할 수 있으므로 주의
   - 민감한 정보(비밀번호 등)는 저장하지 않음

2. **세션 검증**:
   - 매 새로고침마다 서버에서 사용자 상태 확인
   - 비활성화된 계정 자동 차단

3. **만료 처리**:
   - 클라이언트 측에서 만료 시간 체크
   - 만료된 세션은 자동 제거

## 문제 해결

### 세션이 저장되지 않는 경우

1. 브라우저의 localStorage가 활성화되어 있는지 확인
2. 브라우저 개발자 도구 → Application → Local Storage 확인
3. `auth-storage` 키가 있는지 확인

### 자동 로그아웃되는 경우

1. 브라우저 콘솔에서 에러 메시지 확인
2. Supabase에서 `get_user_by_id` 함수가 생성되었는지 확인
3. 사용자 계정이 활성화 상태인지 확인

## 향후 개선 사항

- [ ] "자동 로그인" 체크박스 추가
- [ ] Refresh Token 메커니즘 구현
- [ ] 다중 기기 로그인 관리
- [ ] 세션 활동 로그
