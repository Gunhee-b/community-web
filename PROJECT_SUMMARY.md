# 통찰방 커뮤니티 플랫폼 - 프로젝트 요약

## 📋 프로젝트 개요
250명 규모의 '통찰방' 커뮤니티를 위한 투표 및 오프라인 모임 웹 애플리케이션입니다.

## 🎯 핵심 기능

### 1. 베스트 글 투표 시스템
- 2주마다 자동으로 새로운 투표 기간 생성
- 회원들이 통찰력 있는 글을 추천
- 중복 투표 가능 (같은 글에 여러 번 투표)
- 실시간 투표 현황 표시
- 관리자 검토 후 결과 공개

### 2. 오프라인 모임 시스템
- 모임장/관리자만 모임 생성 가능 (장소, 시간, 인원, 목적 설정)
- 커피 또는 술 모임 선택
- 모임 수정 기능 (모임장/관리자 권한)
- 참가 신청 시 자동으로 모임 채팅방 입장
- 실제 사용자 닉네임으로 채팅 (username 표시)
- 메시지 전송 시간 표시 ("3분 전", "1시간 전" 등)
- Supabase Realtime을 활용한 실시간 채팅
- 주최자 왕관 이모지(👑) 구분 표시
- D-1일 기준 미달 시 자동 취소 기능

### 3. 인증 시스템
- 초대 코드 기반 회원가입 (6자리 숫자 코드)
- 카카오톡 닉네임으로 중복 가입 방지
- bcrypt 비밀번호 해싱 (서버 사이드)
- 3단계 역할 시스템: 관리자 / 모임장 / 일반 회원
- 커스텀 세션 관리 (7일 만료)

### 4. 관리자 대시보드
- 회원 관리 (활성화/비활성화, 역할 변경)
- 투표 기간 생성 및 관리 (제목/설명 커스터마이징)
- 제출된 글 추천수 순 조회
- 우승자 자동 선정 및 표시
- 모임 관리 (모든 모임 조회, 수정, 삭제)
- 초대 코드 생성 (6자리 숫자)
- 초대 코드 무효화/삭제 기능
- 커뮤니티 통계 조회

### 5. 알림 시스템 (v2.3.1)
- 웹 기반 알림 벨 (브라우저 알림 대신)
- 채팅 메시지 알림 (실제 사용자 닉네임 표시)
- 알림 클릭 시 자동 삭제로 깔끔한 관리
- 중복 알림 방지 (읽지 않은 알림만 체크)
- Stale Closure 문제 해결 (useRef 사용)
- 알림 개별 삭제 및 전체 삭제
- localStorage 기반 알림 지속성 (읽지 않은 알림만)

## 🛠 기술 스택

### Frontend
- **React 18.3** - UI 라이브러리
- **Vite** - 빌드 도구
- **React Router 6** - 라우팅
- **Tailwind CSS** - 스타일링
- **Zustand** - 상태 관리
- **date-fns** - 날짜 처리

### Backend & Database
- **Supabase** - BaaS (Backend as a Service)
  - PostgreSQL 데이터베이스
  - Row Level Security (RLS)
  - Realtime 구독
  - Authentication

### Deployment
- **Vercel** - 프론트엔드 호스팅
- **Supabase Cloud** - 데이터베이스 호스팅

## 📁 프로젝트 구조

```
tongchalban-community/
├── src/
│   ├── components/        # 재사용 가능한 컴포넌트
│   │   ├── common/        # 공통 UI 컴포넌트
│   │   ├── auth/          # 인증 컴포넌트
│   │   ├── voting/        # 투표 컴포넌트
│   │   ├── meetings/      # 모임 컴포넌트
│   │   └── admin/         # 관리자 컴포넌트
│   ├── pages/             # 페이지 컴포넌트
│   │   ├── auth/          # 로그인/회원가입
│   │   ├── voting/        # 투표 페이지
│   │   ├── meetings/      # 모임 페이지
│   │   └── admin/         # 관리자 페이지
│   ├── utils/             # 유틸리티 함수
│   ├── lib/               # 외부 라이브러리 설정
│   ├── store/             # 전역 상태 관리
│   └── hooks/             # 커스텀 React 훅
├── supabase/
│   └── migrations/        # 데이터베이스 마이그레이션
└── public/                # 정적 파일
```

## 🗄 데이터베이스 스키마

### 주요 테이블
1. **users** - 사용자 정보
2. **voting_periods** - 투표 기간
3. **posts_nominations** - 추천된 글
4. **votes** - 투표 기록
5. **post_comments** - 글 댓글
6. **offline_meetings** - 오프라인 모임
7. **meeting_participants** - 모임 참가자
8. **meeting_chats** - 익명 채팅
9. **invitation_codes** - 초대 코드

### 보안
- Row Level Security (RLS) 모든 테이블에 적용
- 사용자별 데이터 접근 제어
- 관리자 권한 분리

## 🚀 시작하기

### 1. 의존성 설치
```bash
npm install
```

### 2. 환경 변수 설정
```bash
cp .env.example .env
# .env 파일에 Supabase 정보 입력
```

### 3. Supabase 마이그레이션
```bash
supabase db push
```

### 4. 개발 서버 실행
```bash
npm run dev
```

### 5. 빌드
```bash
npm run build
```

## 📝 주요 페이지

### 공개 페이지
- `/login` - 로그인
- `/signup` - 회원가입

### 회원 페이지
- `/` - 메인 대시보드 (커뮤니티 참가 링크 포함)
- `/questions` - 오늘의 질문 목록
- `/questions/:id` - 질문 상세 및 답변
- `/vote` - 투표 페이지
- `/vote/nominate` - 글 추천
- `/best-posts` - 베스트 글 목록
- `/meetings` - 모임 목록 (모임장/관리자만 생성 가능)
- `/meetings/create` - 모임 생성 (모임장/관리자 전용)
- `/meetings/:id` - 모임 상세 + 익명 채팅
- `/profile` - 프로필

### 관리자 페이지
- `/admin` - 관리자 대시보드
- `/admin/questions` - 질문 관리
- `/admin/votes` - 투표 관리
- `/admin/users` - 회원 관리
- `/admin/meetings` - 모임 관리
- `/admin/invites` - 초대 코드 관리

## 🔐 보안 기능

1. **비밀번호 해싱** - bcrypt 사용
2. **Row Level Security** - Supabase RLS 정책 적용
3. **SQL Injection 방지** - Supabase 쿼리 빌더 사용
4. **XSS 방지** - React의 자동 이스케이핑
5. **인증 토큰** - Supabase JWT 인증
6. **환경 변수** - 민감 정보 분리

## 📊 주요 기능 흐름

### 투표 프로세스
1. 관리자가 2주 단위 투표 기간 생성
2. 회원들이 통찰력 있는 글 추천
3. 회원들이 추천된 글에 투표 (중복 가능)
4. 투표 종료 후 관리자 검토
5. 결과 공개

### 모임 프로세스
1. 모임장/관리자가 모임 생성 (장소, 시간, 인원, 목적)
2. 다른 회원들이 참가 신청
3. 참가 시 익명 이름 자동 부여
4. 익명 채팅방에서 소통 (주최자는 왕관 표시)
5. 모임장/관리자가 모임 정보 수정 가능
6. 모임 당일 오프라인 만남
7. 취소 시 사유 입력 필수

## 🎨 UI/UX 특징

- **반응형 디자인** - 모바일/태블릿/데스크톱 지원
- **심플한 디자인** - 직관적인 인터페이스
- **한국어 인터페이스** - 완전한 한글화
- **실시간 업데이트** - 투표 현황 및 채팅
- **카드 기반 레이아웃** - 모던한 디자인
- **역할 기반 UI** - 권한에 따른 메뉴 표시
- **웹 알림 시스템** - 실시간 알림 벨

## 📈 확장 가능성

### 향후 추가 가능한 기능
1. 푸시 알림 (PWA)
2. 이메일 인증
3. 소셜 로그인 (카카오, 구글)
4. 글 검색 기능
5. 댓글 대댓글
6. 파일 첨부
7. 프로필 이미지
8. 뱃지 시스템
9. 활동 포인트
10. 이모지 반응

## 🐛 알려진 제한사항

1. 다크모드 미지원
2. 이메일 인증 없음
3. 파일 업로드 미지원
4. 검색 기능 없음
5. 브라우저 푸시 알림 없음 (웹 알림만 지원)

## 📚 참고 문서

- [배포 가이드](DEPLOYMENT.md)
- [개발 가이드](DEVELOPMENT.md)
- [README](README.md)

## 🤝 기여

이 프로젝트는 통찰방 커뮤니티를 위한 맞춤형 솔루션입니다.
버그 리포트나 기능 제안은 이슈로 남겨주세요.

## 📄 라이선스

이 프로젝트는 MIT 라이선스를 따릅니다.

---

**버전**: 2.4.0
**최종 업데이트**: 2025년 10월 25일
**개발**: Claude Code

## 📝 최근 업데이트

### v2.4.0 (2025-10-25)
- ✅ 채팅에서 실제 사용자 닉네임 표시
- ✅ 메시지 전송 시간 표시 ("3분 전", "1시간 전" 등)
- ✅ 채팅방 제목 변경 (익명 채팅방 → 모임 채팅방)

### v2.3.1 (2025-10-25)
- ✅ Stale Closure 문제 해결 (폴링 알림 재생성 방지)
- ✅ useRef로 최신 chats 값 참조

### v2.3.0 (2025-10-25)
- ✅ 알림 클릭 시 자동 삭제
- ✅ 중복 체크 로직 개선 (읽지 않은 알림만 체크)
- ✅ localStorage 용량 최적화
