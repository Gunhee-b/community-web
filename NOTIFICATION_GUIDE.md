# 웹 페이지 알림 시스템

브라우저 알림 대신 웹 페이지 내부에 알림 센터를 구현했습니다!

## 🔔 기능 설명

### 알림 벨 (Notification Bell)
- 모든 페이지 상단 오른쪽에 종 모양 아이콘
- 읽지 않은 알림 개수를 빨간 배지로 표시
- 클릭하면 알림 드롭다운 메뉴가 나타남

### 알림 종류
1. **💬 채팅 메시지** - 다른 사용자가 모임 채팅방에 메시지를 보냄
2. **📅 모임 관련** - 향후 추가 가능
3. **🔔 시스템 알림** - 향후 추가 가능

## 📍 위치

알림 벨은 다음 위치에 표시됩니다:
- **MainLayout**: 일반 사용자 페이지 상단
- **AdminLayout**: 관리자 페이지 상단

```
┌─────────────────────────────────────────┐
│ 통찰방  홈  베스트글투표  모임  🔔³ 홍길동님 │
└─────────────────────────────────────────┘
              알림 벨 위치 ↑ (읽지 않은 알림 3개)
```

## 🎯 알림 생성 조건

### 채팅 메시지 알림
다음 조건을 **모두** 만족할 때 알림이 생성됩니다:

1. ✅ 다른 사용자가 메시지를 보냄 (본인 제외)
2. ✅ 같은 모임에 참가 중
3. ✅ Realtime 구독이 활성화됨

**예시:**
- 사용자 A가 모임 채팅에 메시지 전송
- 같은 모임에 참가한 사용자 B, C, D에게 알림 전송
- 사용자 A 본인에게는 알림이 가지 않음

## 💡 알림 기능

### 1. 알림 목록 보기
- 종 아이콘 클릭
- 최신 알림이 위에 표시
- 읽지 않은 알림은 파란색 배경

### 2. 알림 읽기
- 알림을 클릭하면 해당 페이지로 이동
- 자동으로 "읽음" 처리
- 채팅 알림 클릭 → 해당 모임 페이지로 이동

### 3. 모두 읽음
- 드롭다운 상단의 "모두 읽음" 버튼
- 모든 알림을 읽음 처리
- 읽지 않은 개수가 0으로 변경

### 4. 알림 삭제
- 각 알림 오른쪽의 X 버튼
- 개별 알림 삭제

### 5. 전체 삭제
- 드롭다운 상단의 "전체 삭제" 버튼
- 확인 대화상자 후 모든 알림 삭제

## 🗂️ 알림 저장

알림은 브라우저의 **localStorage**에 저장됩니다:
- 페이지를 새로고침해도 유지됨
- 로그아웃해도 유지됨
- 브라우저 캐시 삭제 시 삭제됨

## 📱 알림 UI

### 알림 벨 아이콘
```
🔔       → 알림 없음
🔔³      → 읽지 않은 알림 3개
🔔99+    → 읽지 않은 알림 99개 이상
```

### 알림 드롭다운
```
┌──────────────────────────────────────┐
│ 알림            모두읽음  전체삭제     │
├──────────────────────────────────────┤
│ 💬 새 채팅 메시지                 X  │
│    참가자2: 안녕하세요!               │
│    3분 전                             │
├──────────────────────────────────────┤
│ 💬 새 채팅 메시지                 X  │
│    참가자1: 반갑습니다                │
│    10분 전                            │
└──────────────────────────────────────┘
```

### 읽지 않은 알림
- 파란색 배경 (`bg-blue-50`)
- 눈에 잘 띄게 표시

### 읽은 알림
- 흰색 배경
- 평범하게 표시

## 🛠️ 기술 구현

### 1. Zustand Store
```javascript
// src/store/notificationStore.js
- notifications: 알림 목록 배열
- unreadCount: 읽지 않은 알림 개수
- addNotification(): 새 알림 추가
- markAsRead(): 알림 읽음 처리
- markAllAsRead(): 모두 읽음
- deleteNotification(): 알림 삭제
- clearAllNotifications(): 전체 삭제
```

### 2. NotificationBell 컴포넌트
```javascript
// src/components/common/NotificationBell.jsx
- 종 아이콘과 배지
- 드롭다운 메뉴
- 클릭 외부 감지로 자동 닫기
- 알림 클릭 시 페이지 이동
```

### 3. 알림 생성
```javascript
// MeetingDetailPage에서
addNotification({
  type: 'chat',
  title: '새 채팅 메시지',
  message: `${anonymousName}: ${message}`,
  meetingId: id,
})
```

## 🧪 테스트 방법

### 1. 브라우저 2개 열기
- 창 A: 사용자 1로 로그인
- 창 B: 사용자 2로 로그인

### 2. 같은 모임 참가
- 두 계정 모두 같은 모임에 참가

### 3. 메시지 전송
- 창 A에서 채팅 메시지 전송
- 창 B의 알림 벨 확인 (숫자 증가)

### 4. 알림 확인
- 창 B에서 종 아이콘 클릭
- 새 메시지 알림 확인
- 알림 클릭하면 해당 모임으로 이동

### 5. 알림 관리
- "모두 읽음" 클릭 → 배지 숫자 0
- "전체 삭제" 클릭 → 알림 모두 삭제

## ✨ 특징

### 장점
1. ✅ 브라우저 권한 필요 없음
2. ✅ 모든 브라우저에서 작동
3. ✅ 알림 이력 보관
4. ✅ 알림 관리 기능 (읽음, 삭제)
5. ✅ 클릭으로 페이지 이동
6. ✅ localStorage 저장으로 영구 보관

### 브라우저 알림 대비 차이점
| 기능 | 웹 페이지 알림 | 브라우저 알림 |
|------|---------------|--------------|
| 권한 필요 | ❌ 불필요 | ✅ 필요 |
| 알림 이력 | ✅ 보관 | ❌ 일회성 |
| 알림 관리 | ✅ 가능 | ❌ 불가 |
| 다른 탭에서 | ⚠️ 벨 확인 필요 | ✅ 즉시 표시 |
| 모바일 지원 | ✅ 지원 | ⚠️ 제한적 |

## 🎨 커스터마이징

### 알림 아이콘 변경
```javascript
// NotificationBell.jsx
const getNotificationIcon = (type) => {
  switch (type) {
    case 'chat': return '💬'
    case 'meeting': return '📅'
    case 'system': return '🔔'
    default: return '📢'
  }
}
```

### 알림 스타일 변경
```jsx
// 읽지 않은 알림 배경색
className="bg-blue-50"  // 파란색

// 읽은 알림 배경색
className=""  // 흰색
```

### 알림 최대 개수 제한
```javascript
// notificationStore.js에 추가
const MAX_NOTIFICATIONS = 50

addNotification: (notification) => {
  set((state) => ({
    notifications: [
      newNotification,
      ...state.notifications
    ].slice(0, MAX_NOTIFICATIONS),  // 최대 50개만 유지
    unreadCount: state.unreadCount + 1,
  }))
}
```

## 🚀 향후 개선 가능 사항

1. **읽음 여부 자동 업데이트**
   - 해당 페이지 방문 시 자동으로 읽음 처리

2. **알림 필터링**
   - 채팅만 보기
   - 읽지 않은 것만 보기

3. **알림 사운드**
   - 새 알림 도착 시 소리 재생

4. **알림 그룹화**
   - 같은 모임의 메시지를 하나로 묶기

5. **알림 설정**
   - 사용자가 알림 종류 선택

6. **데스크톱 알림 병행**
   - 웹 알림 + 브라우저 알림 동시 지원

## 🐛 문제 해결

### 알림이 안 오는 경우
1. Realtime 구독 상태 확인
2. 콘솔에서 에러 확인
3. 브라우저 새로고침

### 알림 개수가 안 맞는 경우
1. localStorage 초기화: `localStorage.clear()`
2. 페이지 새로고침

### 알림 클릭이 안 되는 경우
1. 브라우저 캐시 삭제
2. 개발자 도구에서 에러 확인

## 📊 데이터 구조

### 알림 객체
```javascript
{
  id: 1634567890123.456,        // 타임스탬프 + 랜덤
  type: 'chat',                  // 'chat' | 'meeting' | 'system'
  title: '새 채팅 메시지',        // 알림 제목
  message: '참가자2: 안녕하세요!', // 알림 내용
  meetingId: 'uuid...',          // 관련 모임 ID (옵션)
  timestamp: '2024-10-16T...',   // ISO 8601 형식
  read: false,                   // 읽음 여부
}
```

---

**빌드 크기:** 399.00 kB (gzip: 114.63 kB)

**개발 서버 실행:**
```bash
npm run dev
```
