-- ============================================================
-- 차단 기능 테스트 - 단계별 실행
-- ============================================================

-- ============================================================
-- 1단계: 내 사용자 ID 확인
-- ============================================================
SELECT
    auth.uid() as my_user_id,
    'MY_USER_ID' as note;

-- 위 결과의 my_user_id를 복사하세요!

-- ============================================================
-- 2단계: 차단할 사용자 찾기
-- ============================================================
SELECT
    id as user_id,
    email,
    raw_user_meta_data->>'username' as username,
    created_at
FROM auth.users
WHERE id != auth.uid()  -- 나를 제외
ORDER BY created_at DESC
LIMIT 5;

-- 위 결과에서 user_id 하나를 복사하세요!

-- ============================================================
-- 3단계: 차단 함수 테스트
-- ============================================================

-- 아래의 'YOUR_TARGET_USER_ID'를 위에서 복사한 실제 UUID로 교체하세요!

SELECT public.block_user(
    auth.uid(),
    'YOUR_TARGET_USER_ID'::uuid,  -- ← 여기를 실제 UUID로 교체!
    'test blocking'
) as result;

-- 성공하면 결과: {"success": true}
-- 실패하면 결과: {"success": false, "error": "..."}

-- ============================================================
-- 4단계: 차단 목록 확인
-- ============================================================
SELECT
    id,
    blocker_id,
    blocked_id,
    reason,
    created_at
FROM public.user_blocks
WHERE blocker_id = auth.uid();

-- 위에서 차단한 사용자가 보이면 성공!

-- ============================================================
-- 5단계: 차단 해제 테스트
-- ============================================================

SELECT public.unblock_user(
    auth.uid(),
    'YOUR_TARGET_USER_ID'::uuid  -- ← 위에서 사용한 UUID와 동일하게!
) as result;

-- 성공하면 결과: {"success": true}

-- ============================================================
-- 6단계: 차단 목록 다시 확인
-- ============================================================
SELECT
    COUNT(*) as blocked_count
FROM public.user_blocks
WHERE blocker_id = auth.uid();

-- 결과가 0이면 차단 해제 성공!

-- ============================================================
-- 완료!
-- ============================================================
-- 모든 단계가 성공하면 차단 기능이 완벽하게 작동하는 것입니다!
