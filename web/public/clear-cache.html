<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìºì‹œ ì´ˆê¸°í™” - Rezom</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #2563eb;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    button {
      background: #2563eb;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-bottom: 10px;
      transition: background 0.2s;
    }
    button:hover {
      background: #1d4ed8;
    }
    button:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    .status {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      font-size: 14px;
    }
    .status.info {
      background: #dbeafe;
      color: #1e40af;
      border: 1px solid #93c5fd;
    }
    .status.success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #86efac;
    }
    .status.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #fca5a5;
    }
    .info-box {
      background: #f8fafc;
      border-left: 4px solid #2563eb;
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    .info-box h3 {
      margin-top: 0;
      color: #1e40af;
    }
    .info-box ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    .info-box li {
      margin: 5px 0;
    }
    code {
      background: #e2e8f0;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ ìºì‹œ ì´ˆê¸°í™”</h1>
    <p class="subtitle">ë¡œê·¸ì¸ ë¬¸ì œê°€ ìˆë‚˜ìš”? ìºì‹œë¥¼ ì´ˆê¸°í™”í•´ë³´ì„¸ìš”.</p>

    <div class="info-box">
      <h3>ì´ í˜ì´ì§€ëŠ” ì–¸ì œ ì‚¬ìš©í•˜ë‚˜ìš”?</h3>
      <ul>
        <li>ë¡œê·¸ì¸ì´ ë¬´í•œ ë¡œë”©ì— ê±¸ë¦´ ë•Œ</li>
        <li>ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ë°˜ì‘ì´ ì—†ì„ ë•Œ</li>
        <li>ì´ì „ ë²„ì „ì˜ í˜ì´ì§€ê°€ ê³„ì† ë³´ì¼ ë•Œ</li>
        <li>ê´€ë¦¬ìê°€ "ìºì‹œë¥¼ ì‚­ì œí•˜ì„¸ìš”"ë¼ê³  ì•ˆë‚´í–ˆì„ ë•Œ</li>
      </ul>
    </div>

    <button id="clearAllBtn" onclick="clearAll()">
      ğŸ—‘ï¸ ëª¨ë“  ìºì‹œ ì‚­ì œ
    </button>

    <button id="clearCachesBtn" onclick="clearCaches()">
      ğŸ“¦ ë¸Œë¼ìš°ì € ìºì‹œë§Œ ì‚­ì œ
    </button>

    <button id="unregisterSWBtn" onclick="unregisterServiceWorkers()">
      ğŸ”„ Service Worker ì œê±°
    </button>

    <button onclick="goHome()" style="background: #64748b;">
      ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
    </button>

    <div id="status"></div>

    <div class="info-box" style="margin-top: 30px;">
      <h3>ìˆ˜ë™ìœ¼ë¡œ ìºì‹œ ì‚­ì œí•˜ê¸°</h3>
      <p><strong>Windows/Linux:</strong> <code>Ctrl + Shift + R</code></p>
      <p><strong>Mac:</strong> <code>Cmd + Shift + R</code></p>
      <p style="margin-top: 15px;">
        ë˜ëŠ” F12 â†’ Application â†’ Clear storage â†’ Clear site data
      </p>
    </div>
  </div>

  <script>
    function showStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status')
      statusDiv.className = `status ${type}`
      statusDiv.innerHTML = message
      statusDiv.style.display = 'block'
    }

    async function clearCaches() {
      const btn = document.getElementById('clearCachesBtn')
      btn.disabled = true
      btn.textContent = 'ì‚­ì œ ì¤‘...'

      try {
        const cacheNames = await caches.keys()

        if (cacheNames.length === 0) {
          showStatus('âŒ ì‚­ì œí•  ìºì‹œê°€ ì—†ìŠµë‹ˆë‹¤.', 'info')
        } else {
          await Promise.all(cacheNames.map(name => caches.delete(name)))
          showStatus(`âœ… ${cacheNames.length}ê°œì˜ ìºì‹œë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.<br>ì´ë¦„: ${cacheNames.join(', ')}`, 'success')
        }
      } catch (error) {
        showStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error')
      } finally {
        btn.disabled = false
        btn.textContent = 'ğŸ“¦ ë¸Œë¼ìš°ì € ìºì‹œë§Œ ì‚­ì œ'
      }
    }

    async function unregisterServiceWorkers() {
      const btn = document.getElementById('unregisterSWBtn')
      btn.disabled = true
      btn.textContent = 'ì œê±° ì¤‘...'

      try {
        if (!navigator.serviceWorker) {
          showStatus('âŒ Service Workerë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.', 'info')
          return
        }

        const registrations = await navigator.serviceWorker.getRegistrations()

        if (registrations.length === 0) {
          showStatus('âŒ ì œê±°í•  Service Workerê°€ ì—†ìŠµë‹ˆë‹¤.', 'info')
        } else {
          await Promise.all(registrations.map(reg => reg.unregister()))
          showStatus(`âœ… ${registrations.length}ê°œì˜ Service Workerë¥¼ ì œê±°í–ˆìŠµë‹ˆë‹¤.`, 'success')
        }
      } catch (error) {
        showStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error')
      } finally {
        btn.disabled = false
        btn.textContent = 'ğŸ”„ Service Worker ì œê±°'
      }
    }

    async function clearAll() {
      const btn = document.getElementById('clearAllBtn')
      btn.disabled = true
      btn.textContent = 'ì‚­ì œ ì¤‘...'

      showStatus('ğŸ”„ ìºì‹œì™€ Service Workerë¥¼ ëª¨ë‘ ì‚­ì œí•˜ëŠ” ì¤‘...', 'info')

      try {
        // Clear caches
        const cacheNames = await caches.keys()
        await Promise.all(cacheNames.map(name => caches.delete(name)))

        // Unregister service workers
        if (navigator.serviceWorker) {
          const registrations = await navigator.serviceWorker.getRegistrations()
          await Promise.all(registrations.map(reg => reg.unregister()))
        }

        showStatus(
          `âœ… ì™„ë£Œ!<br>` +
          `- ${cacheNames.length}ê°œì˜ ìºì‹œ ì‚­ì œ<br>` +
          `- Service Worker ì œê±°<br><br>` +
          `<strong>ì´ì œ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”!</strong>`,
          'success'
        )

        // 3ì´ˆ í›„ ìë™ ìƒˆë¡œê³ ì¹¨
        setTimeout(() => {
          window.location.href = '/'
        }, 3000)
      } catch (error) {
        showStatus(`âŒ ì˜¤ë¥˜: ${error.message}`, 'error')
      } finally {
        btn.disabled = false
        btn.textContent = 'ğŸ—‘ï¸ ëª¨ë“  ìºì‹œ ì‚­ì œ'
      }
    }

    function goHome() {
      window.location.href = '/'
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ìƒíƒœ í‘œì‹œ
    window.addEventListener('load', async () => {
      try {
        const cacheNames = await caches.keys()
        const swRegistrations = navigator.serviceWorker
          ? await navigator.serviceWorker.getRegistrations()
          : []

        showStatus(
          `ğŸ“Š í˜„ì¬ ìƒíƒœ:<br>` +
          `- ìºì‹œ: ${cacheNames.length}ê°œ<br>` +
          `- Service Worker: ${swRegistrations.length}ê°œ`,
          'info'
        )
      } catch (error) {
        console.error('ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error)
      }
    })
  </script>
</body>
</html>
